{% extends 'base.html' %}

{% block content %}
<div class="container" style="padding-top: 39px;">
    <div class="row">

        <!--------------------        BARRA LATERAL            ------------------------->

        <div class="col-auto col-md-3" style="margin-top: 50px;padding-right: 45px;">
            <div>

                <!--------------------        FORMULARIO BUSQUEDAS             ------------------------->

                <form
                    style="border-radius: 5px;padding-top: 10px;padding-right: 10px;padding-bottom: 10px;padding-left: 10px;border: 1px solid var(--bs-body-bg) ;border-top-style: solid; "
                    method="POST" action="{% url 'buscar' %}">{% csrf_token %}
                    <h1 class="fs-4 text-center" style="color: var(--bs-gray-100);">buscar</h1>
                    <hr
                        style="background: var(--bs-body-bg);border-width: 1px;border-color: var(--bs-body-bg);color: var(--bs-body-bg);margin-top: 10px;margin-bottom: 10px;">
                    <div class="d-flex d-md-flex d-lg-flex justify-content-end justify-content-md-end align-items-md-center justify-content-lg-end"
                        style="margin-top: 15px;padding-bottom: 7px;">
                        <input class="form-control" type="text" placeholder="busqueda" name="busqueda" id="busqueda">
                        <button class="btn btn-primary" type="submit">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </form>

                <!--------------------        FORMULARIO FILTROS             ------------------------->
                <form
                    style="margin-top: 35px;border-radius: 5px;border: 1px solid var(--bs-body-bg);padding-left: 10px;padding-top: 10px;padding-bottom: 10px;padding-right: 10px;"
                    method="POST" action="{% url 'filtro' %}">{% csrf_token %}

                    {% if casillas %}
                    <h1 class="fs-4 text-center" style="color: var(--bs-gray-100);">filtros&nbsp;&nbsp;</h1>
                    <hr
                        style="background: var(--bs-body-bg);border-width: 1px;border-color: var(--bs-body-bg);color: var(--bs-body-bg);">
                    <h6 style="color: var(--bs-body-bg);padding-left: 10px;">estado</h6>

                    {% if casillas.0 == 'on' %}
                    <div class="form-check form-switch" style="color: var(--bs-body-bg);"><input
                            class="form-check-input" type="checkbox" id="Check-1" name="Check-1" checked="">
                        {% else %}
                        <div class="form-check form-switch" style="color: var(--bs-body-bg);"><input
                                class="form-check-input" type="checkbox" id="Check-1" name="Check-1">
                            {% endif %}
                            <label class="form-check-label" for="Check-1">disponible</label>
                        </div>

                        {% if casillas.1 == 'on' %}
                        <div class="form-check form-switch" style="color: var(--bs-body-bg);"><input
                                class="form-check-input" type="checkbox" id="Check-2" name="Check-2" checked="">
                            {% else %}
                            <div class="form-check form-switch" style="color: var(--bs-body-bg);"><input
                                    class="form-check-input" type="checkbox" id="Check-2" name="Check-2">
                                {% endif %}
                                <label class="form-check-label" for="Check-2">prestado</label>
                            </div>


                            <h6 style="color: var(--bs-body-bg);padding: 0px;padding-left: 10px;padding-top: 15px;">
                                categoría</h6>

                            {% if casillas.2 == 'on' %}
                            <div class="form-check form-switch" style="color: var(--bs-body-bg);"><input
                                    class="form-check-input" type="checkbox" id="Check-3" name="Check-3" checked="">
                                {% else %}
                                <div class="form-check form-switch" style="color: var(--bs-body-bg);"><input
                                        class="form-check-input" type="checkbox" id="Check-3" name="Check-3">
                                    {% endif %}
                                    <label class="form-check-label" for="Check-3">computadores</label>
                                </div>

                                {% if casillas.3 == 'on' %}
                                <div class="form-check form-switch" style="color: var(--bs-body-bg);"><input
                                        class="form-check-input" type="checkbox" id="Check-4" name="Check-4" checked="">
                                    {% else %}
                                    <div class="form-check form-switch" style="color: var(--bs-body-bg);"><input
                                            class="form-check-input" type="checkbox" id="Check-4" name="Check-4">
                                        {% endif %}
                                        <label class="form-check-label" for="Check-4">juegos</label>
                                    </div>

                                    <div class="d-xl-flex justify-content-xl-center" style="padding-top: 15px;">
                                        <button class="btn btn-primary" type="submit">filtrar</button>
                                    </div>

                                    {% else %}
                                    <h1 class="fs-4 text-center" style="color: var(--bs-gray-100);">
                                        filtros&nbsp;&nbsp;</h1>
                                    <hr
                                        style="background: var(--bs-body-bg);border-width: 1px;border-color: var(--bs-body-bg);color: var(--bs-body-bg);">
                                    <h6 style="color: var(--bs-body-bg);padding-left: 10px;">estado</h6>
                                    <div class="form-check form-switch" style="color: var(--bs-body-bg);"><input
                                            class="form-check-input" type="checkbox" id="Check-1" name="Check-1"
                                            checked=""><label class="form-check-label" for="Check-1">disponible</label>
                                    </div>
                                    <div class="form-check form-switch" style="color: var(--bs-body-bg);"><input
                                            class="form-check-input" type="checkbox" id="Check-2" name="Check-2"
                                            checked=""><label class="form-check-label" for="Check-2">prestado</label>
                                    </div>
                                    <h6
                                        style="color: var(--bs-body-bg);padding: 0px;padding-left: 10px;padding-top: 15px;">
                                        categoría</h6>
                                    <div class="form-check form-switch" style="color: var(--bs-body-bg);"><input
                                            class="form-check-input" type="checkbox" id="Check-3" name="Check-3"
                                            checked=""><label class="form-check-label"
                                            for="Check-3">computadores</label></div>
                                    <div class="form-check form-switch" style="color: var(--bs-body-bg);"><input
                                            class="form-check-input" type="checkbox" id="Check-4" name="Check-4"
                                            checked=""><label class="form-check-label" for="Check-4">juegos</label>
                                    </div>
                                    <div class="d-xl-flex justify-content-xl-center" style="padding-top: 15px;">
                                        <button class="btn btn-primary" type="submit">filtrar</button>
                                    </div>

                                    {% endif %}
                </form>
            </div>
        </div>

        <!--------------------        FIN BARRA LATERAL            ------------------------->


        <!--------------------        SECTOR DERECHO            ------------------------->


        <div class="col-md-9">
            {% if mensaje_alerta %}
            <div class="text-center d-xl-flex justify-content-xl-center">
                <div class="alert alert-success" role="alert"
                    style="background: var(--bs-danger);color: var(--bs-body-bg);border-style: none;">
                    <span><strong>usuario no encontrado</strong></span></div>
            </div>
            {% endif%}
            {% if mensaje_prestado %}
            <div class="text-center d-xl-flex justify-content-xl-center">
                <div class="alert alert-success" role="alert"
                    style="background: var(--bs-teal);color: var(--bs-body-color);border-style: none;">
                    <span><strong>usuario no encontrado</strong></span></div>
            </div>
            {% endif%}
            <div class="table-responsive" style="border-radius: 5px;border: 1px none var(--bs-body-bg);">

                <!--------------------        TABLA             ------------------------->

                <table class="table table-striped table-dark">
                    <thead>
                        <tr>
                            <th>item</th>
                            <th>categoría</th>
                            <th>estado</th>
                            <th>prestado a...</th>
                            <th>fecha de prestamo</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>

                        <!--------------------        ITERACION DE ITEMS            ------------------------->

                        {% for item in items %}

                        <tr>
                            <td>{{ item.0 }} </td>

                            {% if item.0.ver_categoria == "juego" %}
                            <td><i class="fas fa-gamepad fs-3"></i></td>
                            {% elif item.0.ver_categoria == "computador" %}
                            <td><i class="material-icons fs-2">computer</i></td>
                            {% else %}
                            <td></td>
                            {% endif %}


                            {% if item.0.disponible == True %}
                            <td>disponible</td>
                            {% else %}
                            <td>prestado</td>
                            {% endif %}

                            {% if item.0.disponible == True %}
                            <td></td>
                            <td></td>
                            {% else %}
                            <td>{{ item.1 }}</td>
                            <td>{{ item.2}}</td>
                            {% endif %}

                            <td class="d-lg-flex justify-content-lg-center">
                                {% if item.0.disponible == True %}
                                <button class="btn btn-success" type="button"
                                    style="padding-right: 18px;padding-left: 18px;"
                                    data-bs-target="#modal-{{item.0.id}}" data-bs-toggle="modal">prestar</button>
                                {% else %}
                                <form method="POST" action="{% url 'devolver' %}">{% csrf_token %}
                                    <input id="itemidd" name="itemidd" type="hidden" value="{{item.0.id}}" placeholder="{{item.0.id}}">
                                    <button class="btn btn-danger" type="submit">devolver</button>
                                </form>
                                {% endif %}
                                <form method="POST" action="{% url 'item_' item.0.id %}">{% csrf_token %}
                                    <input id="itemidd" name="itemidd" type="hidden" value="{{item.0.id}}" placeholder="{{item.0.id}}">
                                    <button class="btn btn-secondary" type="submit"
                                        style="text-align: center;padding-left: 18px;padding-right: 18px;margin-left: 10px;">
                                        <i class="fas fa-info-circle fs-5"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>

                        <!--------------------        MENU MODAL             ------------------------->

                        <div class="modal fade" role="dialog" tabindex="-1" id="modal-{{item.0.id}}">
                            <div class="modal-dialog modal-dialog-centered" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4 class="modal-title">{{item.0.nombre}}</h4><button type="button"
                                            class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p>usuario a prestar</p>
                                        <form method="POST" action="{% url 'prestar' %}">{% csrf_token %}
                                            <input class="form-control" type="text" placeholder="rut o rol"
                                                name="user_name" id="user_name" required >
                                            <input id="itemid" name="itemid" type="hidden" value="{{item.0.id}}"
                                                placeholder="{{item.0.id}}">
                                    </div>
                                    <div class="modal-footer"><button class="btn btn-light" type="button"
                                            data-bs-dismiss="modal">cerrar</button><button class="btn btn-success"
                                            type="submit">prestar</button></div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!--------------------        FIN MENU MODAL             ------------------------->

                        <!--------------------        FIN DE ITERACION DE ITEMS             ------------------------->

                        {% endfor %}



                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

{% endblock %}